<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use Case Diagram Analyzer</title>
    <meta name="description" content="Analyze use case diagrams, extract requirements, and estimate software project cost and effort.">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>


   <!-- Toggle Dark Mode -->
<button class="btn btn-sm btn-outline-light toggle-darkmode" onclick="toggleDarkMode()" title="Toggle Dark Mode">
    <i class="fas fa-moon"></i>
  </button>

    <!-- Header / Navbar -->
    <header class="navbar">
        <div class="navbar-container">
            <div class="navbar-logo">
                <i class="fas fa-project-diagram logo-icon"></i>
                <span class="logo-text">UseCase<span class="logo-highlight">Analyzer</span></span>
            </div>
            <!-- <div class="navbar-actions">
                <button class="icon-button" aria-label="Help"><i class="fas fa-question-circle"></i></button>
                <button class="icon-button" aria-label="Settings"><i class="fas fa-cog"></i></button>   
            </div> -->
        </div>
    </header>

    <!-- Main Layout -->
    <div class="container">
        
        <!-- Sidebar Navigation -->
        <nav class="sidebar" aria-label="Sidebar Navigation">
            <ul class="nav-menu">
                <li class="nav-item active">
                    <a href="#" class="nav-link">
                        <i class="fas fa-home"></i><span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item"><a href="#" class="nav-link"><i class="fas fa-file-upload"></i><span>Upload Diagram</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link"><i class="fas fa-list"></i><span>Requirements</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link"><i class="fas fa-chart-line"></i><span>Effort Estimation</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link"><i class="fas fa-money-bill-wave"></i><span>Budget Prediction</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link"><i class="fas fa-clock"></i><span>Timeline</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link"><i class="fas fa-file-export"></i><span>Reports</span></a></li>
            </ul>
            <div class="sidebar-divider"></div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="#" class="nav-link"><i class="fas fa-book"></i><span>Documentation</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link"><i class="fas fa-headset"></i><span>Support</span></a></li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Page Header -->
            <header class="page-header">
                <h1>Use Case Diagram Analyzer</h1>
                <p>Automatically extract functional requirements and estimate project effort from Use Case Diagrams.</p>
            </header>

            <!-- Upload Section -->
            <div class="card shadow-lg border-0 mb-5" style="max-width: 700px; margin: auto;">
                <div class="card-body p-4">
                  <h2 class="h4 mb-4 text-center">
                    <i class="fas fa-chart-line text-primary me-2"></i>Start New Estimation
                  </h2>
              
                  <form action="{{ url_for('main.upload_file') }}" method="post" enctype="multipart/form-data" id="uploadForm">
                    <!-- Project Name -->
                    <div class="mb-3">
                      <label for="project_name" class="form-label">Project Name</label>
                      <input type="text" class="form-control" id="project_name" name="project_name" placeholder="Enter project name" required>
                    </div>
              
                    <!-- Upload Diagram -->
                    <div class="mb-3">
                      <label for="diagram" class="form-label">Upload Use Case Diagram</label>
                      <input type="file" class="form-control" id="diagram" name="diagram" accept=".jpg,.jpeg,.png" required>
                      <div class="form-text">Upload a clear image of your Use Case Diagram (JPG, JPEG, PNG)</div>
                    </div>
              
                    <!-- Preview -->
                    <div class="mb-4 d-none" id="previewContainer">
                      <label class="form-label">Preview</label>
                      <div class="border rounded p-3 text-center">
                        <img id="imagePreview" class="img-fluid" style="max-height: 300px;" alt="Preview Image">
                      </div>
                    </div>
              
                    <!-- Submit Button -->
                    <div class="d-grid">
                      <button type="submit" class="btn btn-primary">
                        <i class="fas fa-upload me-2"></i>Upload & Analyze
                      </button>
                    </div>
                  </form>
                </div>
              </div>
              
                    <!-- File Preview -->
                    <div class="file-preview" id="filePreview" style="display: none;">
                        <div class="preview-container">
                            <div class="preview-image-container">
                                <img id="previewImage" src="" alt="Uploaded Use Case Diagram" class="preview-image">
                            </div>
                            <div class="preview-details">
                                <div class="preview-header">
                                    <h3 id="fileName">file.jpg</h3>
                                    <button id="removeFile" class="btn-remove" aria-label="Remove file">
                                        <i class="fas fa-trash-alt"></i> Remove
                                    </button>
                                </div>
                                <div class="preview-meta" id="fileMeta">0 KB · Last modified: Today</div>
                                <div class="preview-actions">
                                    <button id="startAnalysis" class="btn-primary"><i class="fas fa-play"></i> Start Analysis</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Processing Section -->
            <section class="card status-card" id="processingSection" style="display: none;">
                <div class="card-header">
                    <h2>Processing Diagram</h2>
                    <p>Your diagram is being analyzed</p>
                </div>
                <div class="card-body">
                    <div class="status-container">
                        <div class="status-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressBar" style="width: 0%;"></div>
                            </div>
                            <div class="progress-text">
                                <span id="currentStep">Image Processing</span> - <span id="progressPercent">0%</span>
                            </div>
                        </div>
                        <div class="status-steps">
                            <div class="step active" data-step="upload"><div class="step-icon"><i class="fas fa-upload"></i></div><div class="step-label">Upload</div></div>
                            <div class="step" data-step="image_processing"><div class="step-icon"><i class="fas fa-image"></i></div><div class="step-label">Image Processing</div></div>
                            <div class="step" data-step="ocr"><div class="step-icon"><i class="fas fa-font"></i></div><div class="step-label">OCR</div></div>
                            <div class="step" data-step="nlp_analysis"><div class="step-icon"><i class="fas fa-brain"></i></div><div class="step-label">NLP Analysis</div></div>
                            <div class="step" data-step="estimation"><div class="step-icon"><i class="fas fa-calculator"></i></div><div class="step-label">Estimation</div></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-container" id="resultsSection" style="display: none;">
                <nav class="tabs" aria-label="Results Tabs">
                    <button class="tab-btn active" data-tab="requirements">Requirements</button>
                    <button class="tab-btn" data-tab="effort">Effort Estimation</button>
                    <button class="tab-btn" data-tab="budget">Budget Prediction</button>
                    <button class="tab-btn" data-tab="timeline">Timeline</button>
                </nav>
                <div class="tab-content">
                    <div class="tab-pane active" id="requirements-tab">
                        <h2>Extracted Requirements</h2>
                        <div class="requirements-list" id="requirementsList">
                            <!-- Dynamic content goes here -->
                        </div>
                    </div>
                    <div class="tab-pane" id="effort-tab">
                        <h2>Effort Estimation</h2>
                        <div class="metrics-grid">
                            <div class="metric-card"><h3>Function Points</h3><div class="metric-value">125</div></div>
                            <div class="metric-card"><h3>Use Case Points</h3><div class="metric-value">87</div></div>
                            <div class="metric-card"><h3>Estimated Hours</h3><div class="metric-value">680</div></div>
                            <div class="metric-card"><h3>Team Size</h3><div class="metric-value">3-5</div></div>
                        </div>
                        <div class="chart-container"><canvas id="effortChart"></canvas></div>
                    </div>
                    <div class="tab-pane" id="budget-tab">
                        <h2>Budget Prediction</h2>
                        <div class="budget-summary">
                            <div class="budget-range">
                                <div class="budget-min"><h3>Minimum Budget</h3><div class="budget-value">$45,000</div></div>
                                <div class="budget-max"><h3>Maximum Budget</h3><div class="budget-value">$65,000</div></div>
                            </div>
                            <div class="chart-container"><canvas id="budgetChart"></canvas></div>
                        </div>
                    </div>
                    <div class="tab-pane" id="timeline-tab">
                        <h2>Project Timeline</h2>
                        <div class="timeline-container">
                            <div class="timeline-header">
                                <div class="timeline-duration">
                                    <h3>Estimated Duration</h3>
                                    <div class="duration-value">8–12 weeks</div>
                                </div>
                            </div>
                            <div class="timeline-chart"><canvas id="timelineChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" aria-label="Mobile Navigation">
        <a href="#" class="mobile-nav-item active"><i class="fas fa-home"></i><span>Home</span></a>
        <a href="#" class="mobile-nav-item"><i class="fas fa-file-upload"></i><span>Upload</span></a>
        <a href="#" class="mobile-nav-item"><i class="fas fa-list"></i><span>Results</span></a>
        <a href="#" class="mobile-nav-item"><i class="fas fa-chart-line"></i><span>Estimates</span></a>
    </nav>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

    <!-- JS Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}">
        document.getElementById("startAnalysis").addEventListener("click", async () => {

  document.getElementById('diagram').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
              document.getElementById('imagePreview').src = e.target.result;
              document.getElementById('previewContainer').classList.remove('d-none');
          }
          reader.readAsDataURL(file);
      }
  });

  const data = await response.json();

  if (response.ok) {
    document.getElementById("resultsSection").style.display = "block";
    document.getElementById("processingSection").style.display = "none";
    document.getElementById("requirementsList").innerHTML = `
      ✅ عدد الممثلين: ${data.actors}<br>
      ✅ عدد حالات الاستخدام: ${data.use_cases}<br>
      ⏱️ المدة التقديرية: ${data.estimated_days}<br>
      <img src="${data.result_image}" style="max-width: 100%; margin-top: 20px;">
    `;
  } else {
    alert("❌ فشل التحليل: " + data.error);
    document.getElementById("processingSection").style.display = "none";
  }
});

    </script>
</body>
</html>